<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-cn">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="ä¸‰ç§å»¶æ—¶æ–¹å¼  dispatch_after NSTimer performSelector:withObject:afterDelay">
<meta property="og:type" content="article">
<meta property="og:title" content="å…³äºå»¶æ—¶æ“ä½œä¸€äºŒ">
<meta property="og:url" content="http://yoursite.com/2016/03/20/20160320å…³äºå»¶æ—¶æ“ä½œä¸€äºŒ/index.html">
<meta property="og:site_name" content="iKiwi">
<meta property="og:description" content="ä¸‰ç§å»¶æ—¶æ–¹å¼  dispatch_after NSTimer performSelector:withObject:afterDelay">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2019-06-22T03:32:12.348Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å…³äºå»¶æ—¶æ“ä½œä¸€äºŒ">
<meta name="twitter:description" content="ä¸‰ç§å»¶æ—¶æ–¹å¼  dispatch_after NSTimer performSelector:withObject:afterDelay">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/03/20/20160320å…³äºå»¶æ—¶æ“ä½œä¸€äºŒ/">





  <title>å…³äºå»¶æ—¶æ“ä½œä¸€äºŒ | iKiwi</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-cn">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">iKiwi</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/20/20160320å…³äºå»¶æ—¶æ“ä½œä¸€äºŒ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangdetong">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="iKiwi">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">å…³äºå»¶æ—¶æ“ä½œä¸€äºŒ</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-20T00:00:00+08:00">
                2016-03-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>ä¸‰ç§å»¶æ—¶æ–¹å¼</p>
<ul>
<li>dispatch_after</li>
<li>NSTimer</li>
<li>performSelector:withObject:afterDelay<a id="more"></a>
<h2 id="dispatch-after"><a href="#dispatch-after" class="headerlink" title="dispatch_after"></a>dispatch_after</h2><blockquote>
<p>Schedule a block for execution on a given queue at a specified time.</p>
</blockquote>
</li>
</ul>
<p><code>dispatch_afteræ˜¯å»¶è¿Ÿæäº¤ï¼Œä¸æ˜¯å»¶è¿Ÿè¿è¡Œï¼</code> å³å°†æ‰§è¡ŒBlockåœ¨æŒ‡å®šçš„å»¶æ—¶åï¼ŒåŠ å…¥åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ç‰¹å®šçš„æ—¶é—´åç«‹å³è¿è¡Œï¼</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"me.wangdt.gcd"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="comment">//ç«‹å³æ‰“å°ä¸€æ¡ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"...begin..."</span>);</span><br><span class="line"><span class="comment">//5 ç§’ä»¥åæŠŠblockæäº¤çš„queueä¸­</span></span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">5</span> * <span class="built_in">NSEC_PER_SEC</span>)), queue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"...dispatch_after..."</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//æäº¤ä¸€ä¸ªblock</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">    <span class="comment">//Sleep 10ç§’</span></span><br><span class="line">    [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"...first block done..."</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æ‰“å°é¡ºåºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2016-03-20 00:16:16.212 test[53430:955424] ...begin...</span><br><span class="line">2016-03-20 00:16:26.278 test[53430:955512] ...first block done...</span><br><span class="line">2016-03-20 00:16:26.278 test[53430:955512] ...dispatch_after...</span><br></pre></td></tr></table></figure>

<h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><p>ç›¸å¯¹è€Œè¨€ï¼Œdispatch_afteræ˜¯ä¸ç”¨è€ƒè™‘ å­çº¿ç¨‹runloopçš„é—®é¢˜çš„ğŸ‘ï¼Œåªæ˜¯ä¸èƒ½cancel taskè€Œå·²ï¼Œé€šè¿‡ä¸€äº›å…¶ä»–çš„æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥åšåˆ°å¤§æ¦‚é½çš„ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»´æŠ¤ä¸€ä¸ª shouldExecuteDispatchBlock</span></span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, <span class="number">1</span> * <span class="built_in">NSEC_PER_SEC</span>), dispatch_get_main_queue(), ^ &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">self</span>.shouldExecuteDispatchBlock)&#123;</span><br><span class="line">        <span class="comment">// doSomething</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="dispatch-after-æºç "><a href="#dispatch-after-æºç " class="headerlink" title="dispatch_after æºç "></a>dispatch_after æºç </h3><p>1ï¼Œå½“æ—¶é—´ä¸º0æ—¶ï¼Œç›´æ¥è°ƒç”¨ dispatch_async()<br>2ï¼Œåº•å±‚ä½¿ç”¨äº† dispatch_source è®¾ç½®ä¸€ä¸ªtimerä½œä¸ºå»¶æ—¶</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> dispatch_after(dispatch_time_t when, <span class="built_in">dispatch_queue_t</span> queue,</span><br><span class="line">		dispatch_block_t work)</span><br><span class="line">&#123;</span><br><span class="line">	_dispatch_after(when, queue, <span class="literal">NULL</span>, work, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">_dispatch_after(dispatch_time_t when, <span class="built_in">dispatch_queue_t</span> queue,</span><br><span class="line">		<span class="keyword">void</span> *ctxt, <span class="keyword">void</span> *handler, <span class="keyword">bool</span> block)</span><br><span class="line">&#123;</span><br><span class="line">	dispatch_timer_source_refs_t dt;</span><br><span class="line">	dispatch_source_t ds;</span><br><span class="line">	uint64_t leeway, delta;</span><br><span class="line">	<span class="comment">// ...çœç•¥</span></span><br><span class="line">	<span class="keyword">if</span> (delta == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (block) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">dispatch_async</span>(queue, handler);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dispatch_async_f(queue, ctxt, handler);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ...çœç•¥</span></span><br><span class="line">	<span class="comment">// this function can and should be optimized to not use a dispatch source</span></span><br><span class="line">	ds = dispatch_source_create(&amp;_dispatch_source_type_after, <span class="number">0</span>, <span class="number">0</span>, queue);</span><br><span class="line">	dt = ds-&gt;ds_timer_refs;</span><br><span class="line">	<span class="comment">// ...çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NSTimer"><a href="#NSTimer" class="headerlink" title="NSTimer"></a>NSTimer</h2><p>ä¸¤ç§åˆ›å»ºæ–¹å¼</p>
<blockquote>
<p>Use the scheduledTimerWithTimeInterval:invocation:repeats:<br>or scheduledTimerWithTimeInterval:target:selector:userInfo:repeats:<br>class method to create the timer and schedule it on the current run loop in the default mode.</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSTimer</span> *scheduledTimer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(test:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Use the timerWithTimeInterval:invocation:repeats:<br>or timerWithTimeInterval:target:selector:userInfo:repeats:<br>class method to create the timer object without scheduling it on a run loop. (After creating it, you must add the timer to a run loop manually by calling the addTimer:forMode: method of the corresponding NSRunLoop object.)</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:<span class="number">1</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(test:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">NO</span>];</span><br><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br></pre></td></tr></table></figure>

<p>âš ï¸ä½¿ç”¨æ³¨æ„âš ï¸</p>
<p>å½“åˆ›å»ºä¸€ä¸ªrepeats=YESçš„NSTimeræ—¶ï¼Œéœ€è¦åœ¨åˆé€‚çš„æ—¶é—´é”€æ¯å¹¶ç½®ç©º</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[timer invalidate];  </span><br><span class="line">timer = <span class="literal">nil</span>;</span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹é—®é¢˜</p>
<blockquote>
<p>ä½¿ç”¨NSTimer è‚¯å®šéœ€è¦æŠŠå…¶æ”¾å…¥runloopä¸­çš„ï¼Œæ— è®ºæ˜¯é»˜è®¤add è¿˜æ˜¯ æ‰‹åŠ¨add!</p>
</blockquote>
<ol>
<li>åœ¨ä¸»çº¿ç¨‹ä¸­ä¸ç”¨è€ƒè™‘è¿™ä¸ªï¼Œå› ä¸ºä¸»çº¿ç¨‹runloopé»˜è®¤æ˜¯å¼€å¯çš„ã€‚</li>
<li>å¦‚æœåœ¨å­çº¿ç¨‹ä¸­ï¼Œæ²¡æœ‰æ‰‹åŠ¨å¼€å¯å½“å‰çº¿ç¨‹çš„runloop :[[NSRunLoop currentRunLoop] run];ï¼Œtimeræ˜¯ä¸ä¼šè¢«addåˆ°runloopä¸­çš„ï¼Œä¹Ÿå°±æ„å‘³ç€ timeræ‰€æŒ‡å®šçš„æ–¹æ³•æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œã€‚</li>
<li>è™½ç„¶è¯´åœ¨ä¸»çº¿ç¨‹ä¸­ä¸ä¼šè€ƒè™‘ runloopå¼€å¯çš„é—®é¢˜ï¼Œä½†æ˜¯ å¦‚æœè‡ªå·±å°è£…è¿‡çš„ä»£ç è®©å…¶ä»–äººæ¥ç»´æŠ¤çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å°†å…¶æ”¾åˆ°å­çº¿ç¨‹ä¸­å¹¶ä¸”æ²¡æœ‰å¼€å¯runloopï¼Œå¯¼è‡´å‡ºç°é—®é¢˜ã€‚</li>
</ol>
<h2 id="performSelector-withObject-afterDelay"><a href="#performSelector-withObject-afterDelay" class="headerlink" title="performSelector:withObject:afterDelay"></a>performSelector:withObject:afterDelay</h2><p>å®˜æ–¹ä»‹ç»:</p>
<blockquote>
<p>This method sets up a timer to perform the aSelector message on the current threadâ€™s run loop. The timer is configured to run in the default mode (NSDefaultRunLoopMode). When the timer fires, the thread attempts to dequeue the message from the run loop and perform the selector. It succeeds if the run loop is running and in the default mode; otherwise, the timer waits until the run loop is in the default mode.</p>
</blockquote>
<p>performSelector:withObject:afterDelayçš„åº•å±‚æ˜¯åˆ›å»ºä¸€ä¸ªNSTimer(repeatsä¸ºNO)ï¼Œå¹¶æŠŠæ”¾åˆ°current runloopä¸­ã€‚æ³¨æ„äº‹é¡¹å’ŒNSTimerçš„å·®ä¸å¤šï¼Œåªæ˜¯ä¸ç”¨ç»´æŠ¤è¿™ä¸ªNSTimeräº†ï¼Œå­çº¿ç¨‹çš„é—®é¢˜è¿˜æ˜¯éœ€è¦æ³¨æ„çš„ï¼</p>
<h3 id="performSelector-afterDelayé…åˆcancel"><a href="#performSelector-afterDelayé…åˆcancel" class="headerlink" title="performSelector:afterDelayé…åˆcancel"></a>performSelector:afterDelayé…åˆcancel</h3><p>é€šå¸¸ç”¨è¿™ç§æ–¹å¼åœ¨ä¸»çº¿ç¨‹ å–æ¶ˆé‡å¤åˆ·æ–°UIçš„æ“ä½œ:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">NSObject</span> cancelPreviousPerformRequestsWithTarget: <span class="keyword">self</span> selector:<span class="keyword">@selector</span>(refreshUI) object: <span class="literal">nil</span>];</span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(refreshUI) withObject: <span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br></pre></td></tr></table></figure>

<h3 id="cancelåŸç†"><a href="#cancelåŸç†" class="headerlink" title="cancelåŸç†"></a>cancelåŸç†</h3><p>åŸºæœ¬æ¦‚å¿µ</p>
<ol>
<li>[[NSRunLoop currentRunLoop] run]; ï¼šå¼€å§‹next run loop cycle</li>
<li>performSelector: withObject: afterDelay</li>
</ol>
<blockquote>
<p>Performs the specified selector on the current thread during the next run loop cycle and after an optional delay period.</p>
</blockquote>
<p>åœ¨ä½ åœ¨å­çº¿ç¨‹è¿è¡Œ run loop ä¹‹å‰ï¼Œä½ å¿…é¡»è‡³å°‘æ·»åŠ ä¸€è¾“å…¥æºæˆ–å®šæ—¶å™¨ç»™å®ƒã€‚ å¦‚æœ run loop æ²¡æœ‰ä»»ä½•æºéœ€è¦ç›‘è§†çš„è¯ï¼Œå®ƒä¼šåœ¨ä½ å¯åŠ¨ä¹‹é™…ç«‹é©¬é€€å‡º</p>
<h3 id="è¯¦ç»†çš„ä¾‹å­âš ï¸"><a href="#è¯¦ç»†çš„ä¾‹å­âš ï¸" class="headerlink" title="è¯¦ç»†çš„ä¾‹å­âš ï¸"></a>è¯¦ç»†çš„ä¾‹å­âš ï¸</h3><p>afterDelayçš„é‚£ä¸ªtimeræ˜¯æ”¾åœ¨å“ªäº†ï¼Ÿè¿˜æœ‰timeræ˜¯ä»€ä¹ˆæ—¶å€™æ‹¿å‡ºæ¥æ‰§è¡Œçš„å§ã€‚<br>åœ¨å­çº¿ç¨‹æ‰“å°æ¯”è¾ƒç›´è§‚ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨å­çº¿ç¨‹ä¸­ï¼Œæ‰“å°current runloopï¼ŒæŸ¥çœ‹timerså˜åŒ–ï¼Œè¿›è€Œäº†è§£[[NSRunLoop currentRunLoop] run] çš„ä½œç”¨</span></span><br><span class="line">  <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"currentRunLoop:%@"</span>,[<span class="built_in">NSRunLoop</span> currentRunLoop]);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">        timers = (null),</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	</span><br><span class="line">	[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(test) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"currentRunLoop:%@"</span>,[<span class="built_in">NSRunLoop</span> currentRunLoop]);</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        timers = &lt;CFArray 0x6000000ba0a0 [0x108ef6df0]&gt;&#123;type = mutable-small, count = 1, values = (...&#125;,</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       </span><br><span class="line">       [[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line">       </span><br><span class="line">       <span class="built_in">NSLog</span>(<span class="string">@"currentRunLoop:%@"</span>,[<span class="built_in">NSRunLoop</span> currentRunLoop]); </span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        timers = &lt;CFArray 0x6000000ba0a0 [0x108ef6df0]&gt;&#123;type = mutable-small, count = 0, values = ()&#125;,</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„æ‰“å°å¯ä»¥çœ‹å‡ºæ¥ï¼štimeræ˜¯æ”¾åˆ°runloopçš„ timersæ•°ç»„ä¸­äº†ï¼Œåœ¨[runloop run]å¼€å¯ä¸‹ä¸€æ¬¡run loop cycleçš„æ—¶å€™ï¼Œè§‚å¯Ÿè€…ä¼šå»æ‰§è¡Œtimersä¸­çš„timerã€‚<br>é‚£ä¹ˆåªè¦åœ¨runloop run ä¹‹å‰ï¼ŒæŠŠtimersä¸­æŒ‡å®šçš„timer cancelæ‰å°±è¡Œäº†ï¼Œtryä¸€ä¸‹:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cancelæˆåŠŸäº†</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">	[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(test) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">	[<span class="built_in">NSObject</span> cancelPreviousPerformRequestsWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(test) object:<span class="literal">nil</span>];</span><br><span class="line">	[[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æ¥çœ‹çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œçœ‹çœ‹testæ–¹æ³•è¢«æ‰§è¡Œäº†å‡ æ¬¡ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span> ; i++) &#123;</span><br><span class="line">        [<span class="built_in">NSObject</span> cancelPreviousPerformRequestsWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(test) object:<span class="literal">nil</span>];</span><br><span class="line">        [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(test) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">        [[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆæ˜¯ï¼š 10æ¬¡ï¼<br>ä¸ºä»€ä¹ˆï¼Ÿä¸æ˜¯æœ‰cancelå—ï¼Ÿ<br>å› ä¸ºæ¯æ¬¡ cancelæ—¶ ï¼Œrunloopä¸­çš„timers æ•°ç»„é‡Œçš„timeréƒ½æ‰§è¡Œäº†ï¼Œå³timers çš„count=0ï¼Œæ•…ä¼šæœ‰10æ¬¡ã€‚</p>
<p>å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œtest ä¼šæ‰“å°å‡ æ¬¡ï¼Ÿ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span> ; i++) &#123;</span><br><span class="line">		[<span class="built_in">NSObject</span> cancelPreviousPerformRequestsWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(test) object:<span class="literal">nil</span>];</span><br><span class="line">		[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(test) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	[[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆï¼š1æ¬¡ã€‚</p>
<p>ä»ä¸Šé¢çš„å‡ ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºï¼šcancel æ˜¯ ä» runloop çš„timersé‡Œé¢çš„ timerï¼Œä¹Ÿå°±æ˜¯cancel next run loop cycle çš„timerï¼ï¼ï¼</p>
<h2 id="åçˆ±performSelector-withObject-afterDelay"><a href="#åçˆ±performSelector-withObject-afterDelay" class="headerlink" title="åçˆ±performSelector:withObject:afterDelay"></a>åçˆ±performSelector:withObject:afterDelay</h2><blockquote>
<p>åŸå› ï¼šğŸ‘åœ¨æ“ä½œrunloopçš„æƒ…å†µä¸‹performSelector:withObject:afterDelayä¸­çš„selector å¯ä»¥å–æ¶ˆï¼Œè€Œdispatcch_after çš„blockæ˜¯å»¶æ—¶æäº¤å…¥queueï¼Œè¿˜æ²¡æœ‰åœ¨queueä¸­ ä¸èƒ½è¢«å–æ¶ˆï¼›</p>
</blockquote>
<p>åœºæ™¯: åœ¨åŒä¸€æ—¶åˆ»ï¼Œé¿å…ä¸Šå±‚å¤šæ¬¡è¿›è¡ŒåŒä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼Œæˆ–è€…é‡å¤åˆ·UI</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">NSObject</span> cancelPreviousPerformRequestsWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(requestData:) object:<span class="literal">nil</span>];</span><br><span class="line">[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(requestData:) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šé¢æ›¾æåˆ°çš„ å­çº¿ç¨‹ runloopçš„æƒ…å†µï¼Œæˆ‘ä¸€èˆ¬ä¼šç›´æ¥æ‰”åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    [<span class="built_in">NSObject</span> cancelPreviousPerformRequestsWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(requestData:) object:<span class="literal">nil</span>];</span><br><span class="line">    [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(requestData:) withObject:<span class="literal">nil</span> afterDelay:<span class="number">1</span>];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/02/19/20160219å¼‚æ­¥-å¤šçº¿ç¨‹ï¼Ÿ/" rel="next" title="å¼‚æ­¥==å¤šçº¿ç¨‹ï¼Ÿ">
                <i class="fa fa-chevron-left"></i> å¼‚æ­¥==å¤šçº¿ç¨‹ï¼Ÿ
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/04/07/20160407ç¼–ç è§„èŒƒä¹‹OCæ–°ç‰¹æ€§/" rel="prev" title="ç¼–ç è§„èŒƒä¹‹OCæ–°ç‰¹æ€§">
                ç¼–ç è§„èŒƒä¹‹OCæ–°ç‰¹æ€§ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yOTMzNy81OTA1"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">wangdetong</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#dispatch-after"><span class="nav-number">1.</span> <span class="nav-text">dispatch_after</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ç‰¹ç‚¹"><span class="nav-number">1.1.</span> <span class="nav-text">ç‰¹ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dispatch-after-æºç "><span class="nav-number">1.2.</span> <span class="nav-text">dispatch_after æºç </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NSTimer"><span class="nav-number">2.</span> <span class="nav-text">NSTimer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#performSelector-withObject-afterDelay"><span class="nav-number">3.</span> <span class="nav-text">performSelector:withObject:afterDelay</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#performSelector-afterDelayé…åˆcancel"><span class="nav-number">3.1.</span> <span class="nav-text">performSelector:afterDelayé…åˆcancel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cancelåŸç†"><span class="nav-number">3.2.</span> <span class="nav-text">cancelåŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¯¦ç»†çš„ä¾‹å­âš ï¸"><span class="nav-number">3.3.</span> <span class="nav-text">è¯¦ç»†çš„ä¾‹å­âš ï¸</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åçˆ±performSelector-withObject-afterDelay"><span class="nav-number">4.</span> <span class="nav-text">åçˆ±performSelector:withObject:afterDelay</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wangdetong</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
